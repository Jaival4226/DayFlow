{% extends "base.html" %}
{% block title %}Attendance History{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Attendance Records</h2>
    <button class="btn btn-outline-primary" onclick="loadAttendance()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>
</div>

<div class="card">
    <div class="table-responsive">
        <table class="table table-striped align-middle mb-0">
            <thead class="bg-primary text-white">
                <tr>
                    <th>Date</th>
                    <th>Check In</th>
                    <th>Check Out</th>
                    <th>Work Hours</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="attendanceTable">
                <tr><td colspan="5" class="text-center p-4">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', loadAttendance);

async function loadAttendance() {
    const token = localStorage.getItem('access_token');
    const tbody = document.getElementById('attendanceTable');

    try {
        const response = await fetch('/api/attendance/my-history', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const records = await response.json();

        if (records.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4">No records found.</td></tr>';
            return;
        }

        tbody.innerHTML = records.map(r => `
            <tr>
                <td>${r.date}</td>
                <td>${r.check_in}</td>
                <td>${r.check_out}</td>
                <td>${r.work_hours} hrs</td>
                <td><span class="badge ${getStatusBadge(r.status)}">${r.status}</span></td>
            </tr>
        `).join('');

    } catch (error) {
        console.error(error);
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger p-4">Failed to load data.</td></tr>';
    }
}

function getStatusBadge(status) {
    if(status === 'present') return 'badge-soft-success';
    if(status === 'absent') return 'badge-soft-danger';
    if(status === 'late') return 'badge-soft-warning';
    return 'bg-secondary';
}
</script>

<style>
/* Add the badge styles back if missing */
.badge-soft-success { background-color: #d1e7dd; color: #0f5132; padding: 5px 10px; border-radius: 20px;}
.badge-soft-warning { background-color: #fff3cd; color: #664d03; padding: 5px 10px; border-radius: 20px;}
.badge-soft-danger { background-color: #f8d7da; color: #842029; padding: 5px 10px; border-radius: 20px;}
</style>
{% endblock %}